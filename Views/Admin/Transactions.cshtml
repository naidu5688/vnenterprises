@{
    Layout = "~/Views/Shared/_SharedLayout_Admin.cshtml";
}

<style>
    body {
        background: #17362e;
        font-family: 'Segoe UI', sans-serif;
        color: white;
    }

    .page-container {
        max-width: 100%;
        margin: auto;
        padding: 25px;
    }

    h2 {
        color: #d4af37;
        margin-bottom: 20px;
    }

    /* ===== SUMMARY ===== */
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 15px;
        margin-bottom: 25px;
    }

    .summary-box {
        height: 70px;
        background: #1e4a37;
        border-radius: 12px;
        font-weight: 600;
        /* ✅ BOX FEEL */
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        display: flex;
        align-items: center; /* vertical center */
        padding: 0 18px; /* gives card depth */
    }


    .summary-flex {
        display: flex;
        align-items: center;
        gap: 14px;
        width: 80%;
        height: 100px;
    }

        .summary-box h3 {
            margin: 0;
            font-size: 18px;
        }

        .summary-box span {
            font-size: 11px;
            opacity: .9;
        }

    /* ===== FILTERS ===== */
    .filter-bar {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 20px;
        margin-bottom: 20px;
        align-items: center;
    }

    .form-control {
        background: #1e4a37;
        border: 1px solid #d4af37;
        border-radius: 8px;
        color: white;
        padding: 8px 10px;
        font-size: 14px;
    }

    .btn-primary {
        background: #d4af37;
        color: #17362e;
        border: none;
        border-radius: 8px;
        padding: 10px;
        font-weight: 600;
        cursor: pointer;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    thead {
        background: #0b6b55;
    }

    th, td {
        padding: 14px;
        text-align: center;
        font-size: 14px;
    }

    tbody {
        background: #dff1eb;
        color: black;
    }

    .kyc-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 12px;
    }

    #fSearch {
        grid-column: span 2;
    }

    .btn-edit {
        background: #2980b9;
        border: none;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
    }

    input[type="date"] {
        background-color: #1e4a37;
        border: 1px solid #d4af37;
        border-radius: 8px;
        color: white;
        padding: 8px 10px;
        font-size: 14px;
        height: 35px;
        cursor: pointer;
    }

        /* Calendar icon color (Chrome / Edge) */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1) sepia(1) saturate(5) hue-rotate(20deg);
            cursor: pointer;
        }

        /* Focus effect */
        input[type="date"]:focus {
            outline: none;
            border-color: #f1c40f;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.35);
        }

        /* Placeholder-like empty look */
        input[type="date"]:not(:valid) {
            color: rgba(255,255,255,0.6);
        }

    .summary-icon {
        font-size: 30px;
        text-align: center;
        opacity: 0.95;
        color: #d4af37;
    }

    .summary-flex h3 {
        margin: 0;
        font-size: 22px;
        line-height: 1.2;
    }

    .summary-flex span {
        font-size: 12px;
        opacity: 0.9;
    }

    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 999;
    }

    /* modal container */
    .modal-box {
        background: #065440;
        padding: 22px;
        border-radius: 14px;
        width: 50%;
        /* IMPORTANT */
        max-height: 90vh; /* fit to screen */
        overflow-y: auto; /* enable scroll */
    }

        /* nice scrollbar (optional but recommended) */
        .modal-box::-webkit-scrollbar {
            width: 6px;
        }

        .modal-box::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.4);
            border-radius: 10px;
        }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        padding-bottom: 10px;
        z-index: 2;
    }

        .modal-header h4 {
            color: white;
            font-size: 20px;
            margin: 0;
        }

    /* close icon */
    .close-btn {
        background: transparent;
        border: none;
        color: white;
        font-size: 22px;
        cursor: pointer;
        padding: 0 6px;
    }

    .modal-footer {
        text-align: right;
        margin-top: 15px;
        position: sticky;
        bottom: 0;
        padding-top: 10px;
    }
    .detail-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 15px;
    }

    /* detail box */
    .detail-box label {
        font-size: 15px;
        margin-bottom: 4px;
        display: block;
        color: #e6f5f0;
    }

    .detail-box input {
        width: 100%;
        height: 38px;
        padding: 0 10px;
        border-radius: 8px;
        border: 1px solid #cbded8;
        background: #f4faf8;
    }

    .btn-primary {
        background: #d4af37;
        color: #0d2317;
        border: none;
        border-radius: 10px;
        padding: 10px 18px;
        cursor: pointer;
    }

        .btn-primary:hover {
            background: #594a1b;
        }
</style>

<div class="page-container">

    <h2>Transactions</h2>

    <!-- ✅ TRANSACTION SUMMARY -->
    <div class="summary-grid">
        <div class="summary-box summary-flex">
            <i class="fa-solid fa-arrow-right-arrow-left summary-icon"></i>
            <div>
                <h3 id="sumTotalTxn">0</h3>
                <span>Total Transactions</span>
            </div>
        </div>

        <div class="summary-box summary-flex">
            <i class="fa-solid fa-indian-rupee-sign summary-icon"></i>
            <div>
                <h3 id="sumTotalAmt">₹0</h3>
                <span>Total Transaction Amount</span>
            </div>
        </div>

        <div class="summary-box summary-flex">
            <i class="fa-solid fa-calendar-day summary-icon"></i>
            <div>
                <h3 id="sumTodayTxn">0</h3>
                <span>Today Transactions</span>
            </div>
        </div>

        <div class="summary-box summary-flex">
            <i class="fa-solid fa-coins summary-icon"></i>
            <div>
                <h3 id="sumTodayTxnAmt">₹0</h3>
                <span>Today Transaction Amount</span>
            </div>
        </div>

        <div class="summary-box summary-flex">
            <i class="fa-solid fa-chart-line summary-icon"></i>
            <div>
                <h3 id="sumProfOverall">-</h3>
                <span>Profit Overall</span>
            </div>
        </div>

        <div class="summary-box summary-flex">
            <i class="fa-solid fa-arrow-trend-up summary-icon"></i>
            <div>
                <h3 id="sumProToday">-</h3>
                <span>Profit Today</span>
            </div>
        </div>

    </div>

    <!-- FILTERS (UNTOUCHED) -->
    <div class="filter-bar">
        <select id="fBranch" class="form-control"></select>

        
        <select id="fTransactiontype" class="form-control"></select>

        <select id="tPlatform" class="form-control"></select>
        <select id="tGateway" class="form-control"></select>

        <select id="pageSizeSelect" class="form-control">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="40">40</option>
            <option value="50">50</option>
        </select>

        <input type="date" id="startDate">
        <input type="date" id="endDate">

        <input id="fSearch" class="form-control" placeholder="Search Transaction ID or Customer Name..">
        <button class="btn-primary" onclick="searchTransaction()">Search</button>
        <button class="btn-primary" onclick="exportTransaction()">ExportView</button>
    </div>
    <div class="modal-overlay" id="viewModal">
        <div class="modal-box">

            <!-- HEADER -->
            <div class="modal-header">
                <h4>Transaction Details</h4>
                <button class="close-btn" onclick="closeView()">✕</button>
            </div>

            <!-- BODY -->
            <div class="detail-grid" id="transactionDetails"></div>

            <!-- FOOTER -->
            <div class="modal-footer">
                <button class="btn-primary" onclick="closeView()">Close</button>
            </div>

        </div>
    </div>    <!-- TABLE -->
    <table>
        <thead>
            <tr>
                <th>Transaction Id</th>
                <th>Customer</th>
                <th>Payment Type</th>
                <th>Platform</th>
                <th>Amount</th>
                <th>Profit</th>
                <th>Final Amount</th>
                <th>Date & Time</th>
                <th>CreatedBy</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="empBody">
            <tr><td colspan="10">Loading...</td></tr>
        </tbody>
    </table>

    <div id="pagination" style="display:flex;justify-content:center;gap:6px;margin:15px 0;"></div>
</div>

<script>
    let currentPage = 1;
    let pageSize = 10;
    let totalRecords = 0;
    let exportData = [];

    const fBranch = document.getElementById("fBranch");
    const fSearch = document.getElementById("fSearch");
    const pageSizeSelect = document.getElementById("pageSizeSelect");
    const paginationDiv = document.getElementById("pagination");
    const fTransactiontype = document.getElementById("fTransactiontype");
    const tPlatform = document.getElementById("tPlatform");
    const tGateway = document.getElementById("tGateway");
    const startDate = document.getElementById("startDate");
    const endDate = document.getElementById("endDate");

       document.addEventListener("DOMContentLoaded", async () => {
        await loadTransactionTypes();
        await loadBranches();
        await loadPlatforms();
        await loadTransactionSummary();
        loadTransaction(); // ✅ NOW FILTERS ARE READY
    });
    /* ===== LOAD FILTER DATA ===== */

    function loadBranches() {
        return fetch('/Admin/GetBranches')
            .then(r => r.json())
            .then(d => {
                fBranch.innerHTML = '<option value="">All Branches</option>';
                d.forEach(x =>
                    fBranch.innerHTML += `<option value="${x.branchId}">${x.branchName}</option>`
                );
            });
    }

    function loadTransactionTypes() {
        return fetch('/Employee/TranasactionTypes')
            .then(r => r.json())
            .then(d => {
                fTransactiontype.innerHTML = '<option value="">All Types</option>';
                d.forEach(x =>
                    fTransactiontype.innerHTML += `<option value="${x.id}">${x.name}</option>`
                );
            });
    }

    function loadPlatforms() {
        return fetch('/Employee/GetPlatforms')
            .then(r => r.json())
            .then(d => {
                tPlatform.innerHTML = '<option value="">All Platforms</option>';
                d.forEach(x =>
                    tPlatform.innerHTML += `<option value="${x.id}">${x.name}</option>`
                );
            });
    }

    /* ===== PLATFORM → GATEWAY ===== */

    tPlatform.onchange = function () {
        tGateway.innerHTML = '<option value="">All Gateways</option>';

        if (!this.value) {
            loadTransaction(); // platform cleared
            return;
        }

        fetch('/Employee/GetGateways?platformId=' + this.value)
            .then(r => r.json())
            .then(d => {
                d.forEach(x =>
                    tGateway.innerHTML += `<option value="${x.id}">${x.name}</option>`
                );
                loadTransaction(); // reload after gateway load
            });
    };

    tGateway.onchange =
    fBranch.onchange =
    fTransactiontype.onchange =
    startDate.onchange =
    endDate.onchange = () => {
        currentPage = 1;
        loadTransaction();
    };

    /* ===== PAGE SIZE ===== */

    pageSizeSelect.onchange = () => {
        pageSize = parseInt(pageSizeSelect.value);
        currentPage = 1;
        loadTransaction(); // ✅ FIXED
    };

    /* ===== SEARCH ===== */

    function searchTransaction() {
        currentPage = 1;
        loadTransaction();
    }

        function exportTransaction() {
        const originalPageSize = pageSize;
        pageSize = 50000;

        let start = startDate.value ? startDate.value + " 00:00:00" : '';
        let end = endDate.value ? endDate.value + " 23:59:59" : '';

        const query = {
            BranchId: fBranch.value || '',
            PlatformId: tPlatform.value || '',
            GatewayId: tGateway.value || '',
            TransactionType: fTransactiontype.value || '',
            SearchText: fSearch.value || '',
            StartDate: start,
            EndDate: end,
            PageNo: 1,  // ✅ Fixed
            PageSize: pageSize
        };

        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = '⏳ Exporting...';
        btn.disabled = true;

        fetch('/Admin/GetTransactionForExcel', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(query)
        })
        .then(r => r.json())
        .then(res => {
            const data = res.data || [];

            if (data.length === 0) {
                alert('No data to export');
                resetBtn(btn, originalText, originalPageSize);
                return;
            }

            downloadCSV(data);  // ✅ CSV function
            resetBtn(btn, originalText, originalPageSize);
        })
        .catch(err => {
            alert('Export failed');
            resetBtn(btn, originalText, originalPageSize);
        });
    }

    function resetBtn(btn, originalText, originalPageSize) {
        pageSize = originalPageSize;
        btn.innerHTML = originalText;
        btn.disabled = false;
    }

    function downloadCSV(data) {
        console.log('🔍 First row:', data[0]); // DEBUG property names

        // Split data by IncentiveId (case-safe)
        const getIncentiveId = (row) => row.IncentiveId || row.incentiveId || 0;
        const payments = data.filter(row => getIncentiveId(row) === 2);
        const withdrawals = data.filter(row => getIncentiveId(row) === 3);

        console.log('📊 Payments:', payments.length, 'Withdrawals:', withdrawals.length);

        let csv = '';

        // **PAYMENTS SECTION (IncentiveId = 2)**
        if (payments.length > 0) {
            csv += '\n=== PAYMENTS ===\n\n';
            csv += 'Transaction ID,Customer Name,Employee Name,Incentive Name,Platform Name,Gateway Name,Transaction Amount,Employee Charge %,Employee Charge Amount,Final Amount,Created On,Card Last 4\n';

            payments.forEach(row => {
                csv += [
                    row.TransactionId || row.transactionId || '',
                    `"${(row.CustomerName || row.customerName || '').replace(/"/g, '""')}"`,
                    `"${(row.EmployeeName || row.employeeName || '').replace(/"/g, '""')}"`,
                    row.IncentiveName || row.incentiveName || '',
                    row.PlatformName || row.platformName || '',
                    row.GatewayName || row.gatewayName || '',
                    (row.TransactionAmount || row.transactionAmount || 0).toFixed(2),
                    ((row.EmployeeChargePercent || row.employeeChargePercent || 0).toFixed(2)) + '%',
                    (row.EmployeeChargeAmount || row.employeeChargeAmount || 0).toFixed(2),
                    (row.FinalAmount || row.finalAmount || 0).toFixed(2),
                    row.CreatedOn || row.createdOn || '',
                    row.CardNumber || row.cardNumber || ''
                ].join(',') + '\n';
            });
            csv += '\n';
        }

        // **WITHDRAWALS SECTION (IncentiveId = 3)**
        if (withdrawals.length > 0) {
            csv += '\n=== WITHDRAWALS ===\n\n';
            csv += 'Transaction ID,Customer Name,Employee Name,Incentive Name,Platform Name,Gateway Name,Transaction Amount,Employee Charge %,Employee Charge Amount,Platform Charge,Gateway Charge,Final Amount,Created On,Card Last 4\n';

            withdrawals.forEach(row => {
                csv += [
                    row.TransactionId || row.transactionId || '',
                    `"${(row.CustomerName || row.customerName || '').replace(/"/g, '""')}"`,
                    `"${(row.EmployeeName || row.employeeName || '').replace(/"/g, '""')}"`,
                    row.IncentiveName || row.incentiveName || '',
                    row.PlatformName || row.platformName || '',
                    row.GatewayName || row.gatewayName || '',
                    (row.TransactionAmount || row.transactionAmount || 0).toFixed(2),
                    ((row.EmployeeChargePercent || row.employeeChargePercent || 0).toFixed(2)) + '%',
                    (row.EmployeeChargeAmount || row.employeeChargeAmount || 0).toFixed(2),
                    (row.PlatformCharge || row.platformCharge || 0).toFixed(2),
                    (row.GatewayCharge || row.gatewayCharge || 0).toFixed(2),
                    (row.FinalAmount || row.finalAmount || 0).toFixed(2),
                    row.CreatedOn || row.createdOn || '',
                    row.CardNumber || row.cardNumber || ''
                ].join(',') + '\n';
            });
        }

        if (csv === '') {
            alert('No Payment (ID=2) or Withdrawal (ID=3) data found');
            return;
        }

        // Download CSV
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.href = url;
        link.download = `Transactions_${new Date().toISOString().slice(0,10)}.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }




    /* ===== TRANSACTION SUMMARY ===== */

    function loadTransactionSummary() {
        fetch('/Admin/GetTransactionSummary')
            .then(r => r.json())
            .then(res => {
                sumTotalTxn.innerText = res.totalTransaction || 0;
                sumTotalAmt.innerText = '₹' + (res.totalTransactionsAmount || 0);
                sumTodayTxn.innerText = res.todayTransaction || 0;
                sumTodayTxnAmt.innerText = '₹' + (res.todayTransactionsAmount || 0);
                sumProfOverall.innerText = '₹' + (res.profitOverall || 0);
                sumProToday.innerText = '₹' + (res.profitToday || 0);
            });
    }

    function goToPage(p) {
        if (p < 1) return;
        currentPage = p;
        loadTransaction();
    }
    /* ===== LOAD TRANSACTIONS ===== */

    function loadTransaction() {

        let start = startDate.value ? startDate.value + " 00:00:00" : '';
        let end = endDate.value ? endDate.value + " 23:59:59" : '';

        const query = {
            BranchId: fBranch.value || '',
            PlatformId: tPlatform.value || '',
            GatewayId: tGateway.value || '',
            TransactionType: fTransactiontype.value || '',
            SearchText: fSearch.value || '',
            StartDate: start,
            EndDate: end,
            PageNo: currentPage,
            PageSize: pageSize
        };

        fetch('/Admin/GetTransaction', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(query)
        })
        .then(r => r.json())
        .then(res => {
            totalRecords = res.totalCount || 0;
            empBody.innerHTML = "";

            if (!res.data || res.data.length === 0) {
                empBody.innerHTML = `<tr><td colspan="9">No records found</td></tr>`;
                paginationDiv.innerHTML = "";
                return;
            }

            res.data.forEach(e => {
                empBody.innerHTML += `
                    <tr>
                        <td>${e.transactionId}</td>
                        <td>${e.customerName}</td>
                        <td>${e.incentiveName}</td>
                        <td>${e.platformName}</td>
                        <td>${e.transactionAmount}</td>
                        <td>${e.employeeChargeAmount}</td>
                        <td>${e.finalAmount}</td>
                        <td>${e.createdOn}</td>
                        <td>${e.employeeName}</td>
                        <td><button class="btn-primary" onclick="viewTransaction(${e.transactionId})">View</button></td>
                        
                    </tr>`;
            });

            renderPagination();
        });
    }
    function loadTransactionForExcel() {

        let start = startDate.value ? startDate.value + " 00:00:00" : '';
        let end = endDate.value ? endDate.value + " 23:59:59" : '';

        const query = {
            BranchId: fBranch.value || '',
            PlatformId: tPlatform.value || '',
            GatewayId: tGateway.value || '',
            TransactionType: fTransactiontype.value || '',
            SearchText: fSearch.value || '',
            StartDate: start,
            EndDate: end,
            PageNo: currentPage,
            PageSize: pageSize
        };

        fetch('/Admin/GetTransactionForExcel', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(query)
        })
        .then(r => r.json())
        .then(res => {
            totalRecords = res.totalCount || 0;
            empBody.innerHTML = "";

            if (!res.data || res.data.length === 0) {
                empBody.innerHTML = `<tr><td colspan="9">No records found</td></tr>`;
                paginationDiv.innerHTML = "";
                return;
            }

            res.data.forEach(e => {
                empBody.innerHTML += `
                    <tr>
                        <td>${e.transactionId}</td>
                        <td>${e.customerName}</td>
                        <td>${e.incentiveName}</td>
                        <td>${e.platformName}</td>
                        <td>${e.transactionAmount}</td>
                        <td>${e.employeeChargeAmount}</td>
                        <td>${e.finalAmount}</td>
                        <td>${e.createdOn}</td>
                        <td>${e.employeeName}</td>
                        <td><button class="btn-primary" onclick="viewTransaction(${e.transactionId})">View</button></td>

                    </tr>`;
            });

            renderPagination();
        });
    }
    function closeView() {
    viewModal.style.display = 'none';
    }
    function viewTransaction(id) {
        fetch('/Employee/GetTransactionById?transactionid=' + id)
            .then(r => r.json())
            .then(d => {

                if (!d) {
                    alert("No data found");
                    return;
                }

                transactionDetails.innerHTML = `
                <div class="detail-box">
                    <label>Transaction ID</label>
                    <input value="${d.transactionId}" readonly>
                </div>
                <div class="detail-box">
                    <label>Customer Name</label>
                    <input value="${d.customerName}" readonly>
                </div>
                <div class="detail-box">
                    <label>Platform Name</label>
                    <input value="${d.platformName}" readonly>
                </div>
                <div class="detail-box">
                    <label>Gateway Name</label>
                    <input value="${d.gatewayName}" readonly>
                </div>
                <div class="detail-box">
                    <label>Platform Charge(%)</label>
                    <input value="${d.gatewayCharge}" readonly>
                </div>
                <div class="detail-box">
                    <label>Transaction Type</label>
                    <input value="${d.incentiveName}" readonly>
                </div>
                <div class="detail-box">
                    <label>Credit Card Number</label>
                    <input value="${d.cardNumber}" readonly>
                </div>
                <div class="detail-box">
                    <label>Card Type</label>
                    <input value="${d.cardTypeName}" readonly>
                </div>
                <div class="detail-box">
                    <label>Card CVV</label>
                    <input value="${d.cardCVV}" readonly>
                </div>
                <div class="detail-box">
                    <label>Expiry Date</label>
                    <input value="${d.cardExpiryDate}" readonly>
                </div>
                <div class="detail-box">
                    <label>Transaction Amount</label>
                    <input value="${d.transactionAmount}" readonly>
                </div>
                <div class="detail-box">
                    <label>Platform Charge Amount</label>
                    <input value="${d.platformCharge}" readonly>
                </div>
                <div class="detail-box">
                    <label>Employee Charge Percent (%)</label>
                    <input value="${d.employeeChargePercent}" readonly>
                </div>
                <div class="detail-box">
                    <label>Profit Amount</label>
                    <input value="${d.employeeChargeAmount}" readonly>
                </div>
                <div class="detail-box">
                    <label>PayOut Amount</label>
                    <input value="${d.payOut}" readonly>
                </div>
                <div class="detail-box">
                    <label>Final Amount</label>
                    <input value="₹${d.finalAmount}" readonly>
                </div>
                <div class="detail-box">
                    <label>Bank Account Number</label>
                    <input value="${d.bankAccountNumber}" readonly>
                </div>
                <div class="detail-box">
                    <label>Bank IFSC</label>
                    <input value="${d.bankIFSC}" readonly>
                </div>
                <div class="detail-box">
                    <label>Remark</label>
                    <input value="${d.remark}" readonly>
                </div>
                `;

                viewModal.style.display = 'flex';
            });
    }

    /* ===== PAGINATION ===== */

    // function renderPagination() {
    //     paginationDiv.innerHTML = "";
    //     const totalPages = Math.ceil(totalRecords / pageSize);

    //     if (totalPages <= 1) return;

    //     for (let i = 1; i <= totalPages; i++) {
    //         const btn = document.createElement("button");
    //         btn.innerText = i;
    //         btn.className = "btn-primary";
    //         btn.disabled = i === currentPage;
    //         btn.onclick = () => {
    //             currentPage = i;
    //             loadTransaction(); // ✅ FIXED
    //         };
    //         paginationDiv.appendChild(btn);
    //     }
    // }

    function renderPagination() {
        const totalPages = Math.ceil(totalRecords / pageSize);
        paginationDiv.innerHTML = "";

        if (totalPages <= 1) return;

        const prev = document.createElement("button");
        prev.innerText = "Prev";
        prev.className = "btn-primary";
        prev.disabled = currentPage === 1;
        prev.onclick = () => goToPage(currentPage - 1);
        paginationDiv.appendChild(prev);

        let start = Math.max(1, currentPage - 1);
        let end = Math.min(totalPages, start + 2);
        start = Math.max(1, end - 2);

        for (let i = start; i <= end; i++) {
            const btn = document.createElement("button");
            btn.innerText = i;
            btn.className = "btn-primary";
            btn.style.padding = "6px 12px";
            btn.disabled = i === currentPage;
            btn.style.opacity = i === currentPage ? "0.6" : "1";
            btn.onclick = () => goToPage(i);
            paginationDiv.appendChild(btn);
        }

        const next = document.createElement("button");
        next.innerText = "Next";
        next.className = "btn-primary";
        next.disabled = currentPage === totalPages;
        next.onclick = () => goToPage(currentPage + 1);
        paginationDiv.appendChild(next);
    }
</script>

